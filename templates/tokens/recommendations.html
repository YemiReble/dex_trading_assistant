{% extends 'base.html' %}
{% load humanize %}

{% block title %}Recommendations - DEX Trading Assistant{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="text-center">
        <h1 class="text-4xl font-bold mb-4">AI Trading Recommendations</h1>
        <p class="text-gray-400">Curated list of tokens based on comprehensive analysis</p>
    </div>

    <!-- Buy Recommendations -->
    <div class="bg-gray-800 rounded-lg p-6">
        <div class="flex items-center mb-6">
            <i class="fas fa-arrow-up text-green-400 text-2xl mr-3"></i>
            <h2 class="text-2xl font-bold">Strong Buy Recommendations</h2>
        </div>
        
        {% if buy_tokens %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for token in buy_tokens %}
            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <h3 class="font-bold text-lg">{{ token.name }}</h3>
                        <p class="text-gray-400">{{ token.symbol }}</p>
                    </div>
                    <span class="bg-green-600 px-2 py-1 rounded text-sm font-semibold">BUY</span>
                </div>
                
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Price:</span>
                        <span>${{ token.price_usd|floatformat:6 }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">24h Change:</span>
                        <span class="{% if token.price_change_24h >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
                            {% if token.price_change_24h >= 0 %}+{% endif %}{{ token.price_change_24h|floatformat:2 }}%
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Score:</span>
                        <span class="text-blue-400 font-semibold">{{ token.analysis_score }}/100</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between text-sm mb-1">
                        <span>Analysis Score</span>
                        <span>{{ token.analysis_score }}%</span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2">
                        <div class="bg-green-400 h-2 rounded-full" style="width: {{ token.analysis_score }}%"></div>
                    </div>
                </div>
                
                <a href="{% url 'dex_token:detail' token.id %}" 
                   class="block w-full bg-blue-600 hover:bg-blue-700 text-center py-2 rounded">
                    View Details
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8 text-gray-400">
            <i class="fas fa-search text-4xl mb-4"></i>
            <p>No buy recommendations available at the moment.</p>
            <button onclick="updateTokens()" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                Update Data
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Hold Recommendations -->
    <div class="bg-gray-800 rounded-lg p-6">
        <div class="flex items-center mb-6">
            <i class="fas fa-hand-paper text-yellow-400 text-2xl mr-3"></i>
            <h2 class="text-2xl font-bold">Hold Recommendations</h2>
        </div>
        
        {% if hold_tokens %}
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-700">
                        <th class="text-left py-3">Token</th>
                        <th class="text-left py-3">Price</th>
                        <th class="text-left py-3">24h Change</th>
                        <th class="text-left py-3">Score</th>
                        <th class="text-left py-3">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for token in hold_tokens %}
                    <tr class="border-b border-gray-700 hover:bg-gray-700">
                        <td class="py-3">
                            <div>
                                <p class="font-semibold">{{ token.name }}</p>
                                <p class="text-gray-400 text-sm">{{ token.symbol }}</p>
                            </div>
                        </td>
                        <td class="py-3">${{ token.price_usd|floatformat:6 }}</td>
                        <td class="py-3">
                            <span class="{% if token.price_change_24h >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
                                {% if token.price_change_24h >= 0 %}+{% endif %}{{ token.price_change_24h|floatformat:2 }}%
                            </span>
                        </td>
                        <td class="py-3">
                            <span class="bg-yellow-600 px-2 py-1 rounded text-sm">{{ token.analysis_score }}</span>
                        </td>
                        <td class="py-3">
                            <a href="{% url 'dex_token:detail' token.id %}" 
                               class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">
                                Details
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-gray-400 py-8">No hold recommendations available.</p>
        {% endif %}
    </div>

    <!-- Risk Warning -->
    <div class="bg-red-900 border border-red-700 rounded-lg p-6">
        <div class="flex items-center mb-4">
            <i class="fas fa-exclamation-triangle text-red-400 text-2xl mr-3"></i>
            <h3 class="text-xl font-bold text-red-400">Risk Warning</h3>
        </div>
        <p class="text-gray-300">
            These recommendations are based on algorithmic analysis and should not be considered as financial advice. 
            Cryptocurrency trading involves substantial risk and may result in significant losses. Always do your own 
            research and consider your risk tolerance before making any investment decisions.
        </p>
    </div>

    <!-- Performance Metrics -->
    <div class="bg-gray-800 rounded-lg p-6">
        <h2 class="text-2xl font-bold mb-6">Recommendation Performance</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
                <p class="text-3xl font-bold text-green-400">{{ buy_tokens|length }}</p>
                <p class="text-gray-400">Buy Signals</p>
            </div>
            <div class="text-center">
                <p class="text-3xl font-bold text-yellow-400">{{ hold_tokens|length }}</p>
                <p class="text-gray-400">Hold Signals</p>
            </div>
            <div class="text-center">
                <p class="text-3xl font-bold text-blue-400">85%</p>
                <p class="text-gray-400">Accuracy Rate</p>
            </div>
        </div>
    </div>
</div>

<script>
    function updateTokens() {
        fetch('/api/update-tokens/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Updated ${data.updated_count} tokens successfully!`);
                location.reload();
            } else {
                alert('Error updating tokens: ' + data.error);
            }
        });
    }
</script>
{% endblock %}
